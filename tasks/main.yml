---
# tasks file for OULibraries.searchgateway
- name: clone searchgateway repo
  git:
    dest: "/srv/searchgateway"
    repo: "https://github.com/OULibraries/searchgateway.git"
    
- name: Set default SELinux context for searchgateway files
  command: >
    semanage fcontext -a -t httpd_sys_rw_content_t  "/srv/searchgateway(/.*)?"
  sudo: yes

- name: Restore default SELinux context for search gateway files
  command: >
    restorecon -rv /srv/searchgateway
  sudo: yes

- name: Add searchgatway config to nginx
  template:
    src: "search.inc.j2"
    dest: "/etc/nginx/conf.d/search.conf.inc"
    owner: root
    group: root
    mode: 0644
